<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #map {
            width: 100%;
            height: calc(100vh - 109px);
            margin-top: 48px;
        }
        .search-btns {
            position: absolute;
            top: 58px;
            right: 20px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .search-btns button {
            width: 110px;
            padding: 15px;
            background-color: #007BFF; /* primary color */
            border-radius: 10px;
            font-size: 1.2em;
            color: #FFFFFF; /* white color */
        }
        .search-btns button:hover {
            background-color: #FFC107; /* warning color */
        }
    </style>
</head>
<body>
<!-- Kakao Map ì»¨í…Œì´ë„ˆ -->
<div id="map"></div>
<!-- ê²€ìƒ‰ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ-->
<div class="search-btns">
    <!--    <button type="button" onclick="searchPlaces('ì• ê²¬ì¹´í˜')">ì• ê²¬ì¹´í˜ :ì»¤í”¼:ï¸</button>-->
    <!--    <button type="button" onclick="searchPlaces('ë™ë¬¼ë³‘ì›')">ë™ë¬¼ë³‘ì› :ì˜ë£Œ_ì¢…ì‚¬ì:</button>-->
    <!--    <button type="button" onclick="searchPlaces('ì• ê²¬í˜¸í…”')">ì• ê²¬í˜¸í…” :í˜¸í…”:</button>-->
    <button id="cafeBtn" type="button">ì• ê²¬ì¹´í˜ â˜•ï¸</button>
    <button id="hospitalBtn" type="button">ë™ë¬¼ë³‘ì› ğŸ§‘â€âš•ï¸</button>
    <button id="hotelBtn" type="button">ì• ê²¬í˜¸í…” ğŸ¨</button>
</div>
<!-- kakao ì§€ë„ API ë¶ˆëŸ¬ì˜¤ê¸° -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=fa50bac5a61c8b7be8bba979347a108c&libraries=services"></script>
<!--<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=services"></script>-->
<!--<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=fa50bac5a61c8b7be8bba979347a108c"></script>-->
<!-- Kakao Map ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ -->
<script th:inline="javascript">
    document.addEventListener("DOMContentLoaded", function () {
        // var mapContainer = document.getElementById('map');
        // var options = { //ì§€ë„ë¥¼ ìƒì„±í•  ë•Œ í•„ìš”í•œ ê¸°ë³¸ ì˜µì…˜
        //     center: new kakao.maps.LatLng(33.450701, 126.570667), //ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
        //     level: 3 //ì§€ë„ì˜ ë ˆë²¨(í™•ëŒ€, ì¶•ì†Œ ì •ë„)
        // };
        // var map = new kakao.maps.Map(mapContainer, options); //ì§€ë„ ìƒì„± ë° ê°ì²´ ë¦¬í„´
        // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€

        document.getElementById('cafeBtn').addEventListener('click', function() {

            ps.keywordSearch("ì• ê²¬ì¹´í˜", placesSearchCB);
        });
        document.getElementById('hospitalBtn').addEventListener('click', function() {

            ps.keywordSearch("ë™ë¬¼ë³‘ì›", placesSearchCB);
        });
        document.getElementById('hotelBtn').addEventListener('click', function() {

            ps.keywordSearch("ì• ê²¬í˜¸í…”", placesSearchCB);
        });
        // í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                function (position) {
                    var userLatLng = new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude);
                    map.setCenter(userLatLng);
                    var markerImageSrc = 'https://cdn-icons-png.flaticon.com/128/7124/7124723.png';
                    var markerSize = new kakao.maps.Size(50, 50);
                    var markerImage = new kakao.maps.MarkerImage(markerImageSrc, markerSize);
                    var markerPosition = new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude);
                    var marker = new kakao.maps.Marker({
                        position: markerPosition,
                        image: markerImage
                    });
                    marker.setMap(map);
                },
                function (error) {
                    console.error(error.message);
                }
            );
        } else {
            console.error('Geolocation is not supported.');
        }
        // ê²€ìƒ‰ëœ ì¥ì†Œ í‘œì‹œí•˜ê¸°
    })
    var infowindow = new kakao.maps.InfoWindow({zIndex:1});
    var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div
        mapOption = {
            center: new kakao.maps.LatLng(37.566826, 126.9786567), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
            level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
        };
    // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
    var map = new kakao.maps.Map(mapContainer, mapOption);
    // ì¥ì†Œ ê²€ìƒ‰ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
    var ps = new kakao.maps.services.Places();
    // í‚¤ì›Œë“œë¡œ ì¥ì†Œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤
    // í‚¤ì›Œë“œ ê²€ìƒ‰ ì™„ë£Œ ì‹œ í˜¸ì¶œë˜ëŠ” ì½œë°±í•¨ìˆ˜ ì…ë‹ˆë‹¤
    function placesSearchCB (data, status, pagination) {
        if (status === kakao.maps.services.Status.OK) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        var userLatLng = new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude);
                        map.setCenter(userLatLng);
                        var markerImageSrc = 'https://cdn-icons-png.flaticon.com/128/7124/7124723.png';
                        var markerSize = new kakao.maps.Size(50, 50);
                        var markerImage = new kakao.maps.MarkerImage(markerImageSrc, markerSize);
                        var markerPosition = new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude);
                        var marker = new kakao.maps.Marker({
                            position: markerPosition,
                            image: markerImage
                        });
                        marker.setMap(map);
                    },
                    function (error) {
                        console.error(error.message);
                    }
                );
            } else {
                console.error('Geolocation is not supported.');
            }
            map = new kakao.maps.Map(mapContainer, mapOption);
            // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•˜ê¸°ìœ„í•´
            // LatLngBounds ê°ì²´ì— ì¢Œí‘œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
            var bounds = new kakao.maps.LatLngBounds();
            for (var i=0; i<data.length; i++) {
                displayMarker(data[i]);
                bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
            }
            // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤
            map.setBounds(bounds);
        }
    }
    // ì§€ë„ì— ë§ˆì»¤ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
    function displayMarker(place) {
        // ë§ˆì»¤ë¥¼ ìƒì„±í•˜ê³  ì§€ë„ì— í‘œì‹œí•©ë‹ˆë‹¤
        var marker = new kakao.maps.Marker({
            map: map,
            position: new kakao.maps.LatLng(place.y, place.x)
        });
        // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
        kakao.maps.event.addListener(marker, 'click', function() {
            // ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ì¥ì†Œëª…ì´ ì¸í¬ìœˆë„ìš°ì— í‘œì¶œë©ë‹ˆë‹¤
            infowindow.setContent('<div style="padding:5px;font-size:12px;">' + place.place_name + '</div>');
            infowindow.open(map, marker);
        });
    }
</script>
</body>
</html>