
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #map {
            width: 100%;
            height: calc(100vh - 109px);
            margin-top: 48px;
        }
        .search-btns {
            position: absolute;
            top: 58px;
            right: 20px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .search-btns button {
            width: 110px;
            padding: 15px;
            background-color: #007bff; /* primary color */
            border-radius: 10px;
            font-size: 1.2em;
            color: #ffffff; /* white color */
        }
        .search-btns button:hover {
            background-color: #ffc107; /* warning color */
        }
    </style>
</head>
<body>
<!-- Kakao Map ì»¨í…Œì´ë„ˆ -->
<div id="map"></div>
<!-- ê²€ìƒ‰ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ-->
<div class="search-btns">
    <!--    <button type="button" onclick="searchPlaces('ì• ê²¬ì¹´í˜')">ì• ê²¬ì¹´í˜ â˜•ï¸</button>-->
    <!--    <button type="button" onclick="searchPlaces('ë™ë¬¼ë³‘ì›')">ë™ë¬¼ë³‘ì› ğŸ§‘â€âš•ï¸</button>-->
    <!--    <button type="button" onclick="searchPlaces('ì• ê²¬í˜¸í…”')">ì• ê²¬í˜¸í…” ğŸ¨</button>-->
    <button id="cafeBtn" type="button">ì• ê²¬ì¹´í˜ â˜•ï¸</button>
    <button id="hospitalBtn" type="button">ë™ë¬¼ë³‘ì› ğŸ§‘â€âš•ï¸</button>
    <button id="hotelBtn" type="button">ì• ê²¬í˜¸í…” ğŸ¨</button>
</div>
<!-- kakao ì§€ë„ API ë¶ˆëŸ¬ì˜¤ê¸° -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=APIKEY&libraries=services,clusterer,drawing"></script>
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=fa50bac5a61c8b7be8bba979347a108c"></script>

<!-- Kakao Map ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ -->
<script th:inline="javascript">
    var map;
    var markers = [];

    document.addEventListener("DOMContentLoaded", function () {
        var mapContainer = document.getElementById('map');
        var options = { //ì§€ë„ë¥¼ ìƒì„±í•  ë•Œ í•„ìš”í•œ ê¸°ë³¸ ì˜µì…˜
            center: new kakao.maps.LatLng(33.450701, 126.570667), //ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
            level: 3 //ì§€ë„ì˜ ë ˆë²¨(í™•ëŒ€, ì¶•ì†Œ ì •ë„)
        };
        map = new kakao.maps.Map(mapContainer, options); //ì§€ë„ ìƒì„± ë° ê°ì²´ ë¦¬í„´

        // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        document.getElementById('cafeBtn').addEventListener('click', function() {
            searchPlaces("ì• ê²¬ì¹´í˜");
        });

        document.getElementById('hospitalBtn').addEventListener('click', function() {
            searchPlaces('ë™ë¬¼ë³‘ì›');
        });

        document.getElementById('hotelBtn').addEventListener('click', function() {
            searchPlaces('ì• ê²¬í˜¸í…”');
        });

        // í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                function (position) {
                    var userLatLng = new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude);
                    map.setCenter(userLatLng);

                    var markerImageSrc = 'https://cdn-icons-png.flaticon.com/128/7124/7124723.png';
                    var markerSize = new kakao.maps.Size(50, 50);
                    var markerImage = new kakao.maps.MarkerImage(markerImageSrc, markerSize);
                    var markerPosition = new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude);
                    var marker = new kakao.maps.Marker({
                        position: markerPosition,
                        image: markerImage
                    });
                    marker.setMap(map);
                },
                function (error) {
                    console.error(error.message);
                }
            );
        } else {
            console.error('Geolocation is not supported.');
        }
        // ê²€ìƒ‰ëœ ì¥ì†Œ í‘œì‹œí•˜ê¸°
        function displayPlaces(data) {
            var bounds = new kakao.maps.LatLngBounds();
            for (var i = 0; i < data.length; i++) {
                bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
            }
            bounds.extend(new kakao.maps.LatLng(state.center.lat, state.center.lng));
            map.setBounds(bounds);
            setSearch(data);
        }

        // í‚¤ì›Œë“œ ê²€ìƒ‰ ì™„ë£Œ ì‹œ í˜¸ì¶œë˜ëŠ” ì½œë°±í•¨ìˆ˜
        function placesSearchCB (data, status, pagination) {
            if (status === kakao.maps.services.Status.OK) {

                // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•˜ê¸°ìœ„í•´
                // LatLngBounds ê°ì²´ì— ì¢Œí‘œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
                var bounds = new kakao.maps.LatLngBounds();

                for (var i=0; i<data.length; i++) {
                    displayMarker(data[i]);
                    bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
                }

                // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤
                map.setBounds(bounds);
            }
        }

        // ì£¼ë³€ ìœ„ì¹˜ ì¹´í…Œê³ ë¦¬ë¡œ ê²€ìƒ‰í•˜ê¸°
        function searchPlaces(keyword) {
            // Places ì„œë¹„ìŠ¤ ê°ì²´ ìƒì„±
            var ps = new kakao.maps.services.Places();
            // ê²€ìƒ‰ ì˜µì…˜ ì„¤ì •
            var options = {
                location: new kakao.maps.LatLng(state.center.lat, state.center.lng),
                radius: 5000,
                sort: kakao.maps.services.SortBy.DISTANCE,
            };

            // Places ì„œë¹„ìŠ¤ì˜ keywordSearch ë©”ì†Œë“œ í˜¸ì¶œ
            ps.categorySearch(
                keyword,
                function(data, status, pagination) {
                    if (status === kakao.maps.services.Status.OK) {
                        console.log(data);
                        placesSearchCB(data, status, pagination); // ê²€ìƒ‰ëœ ì¥ì†Œë¥¼ ì§€ë„ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ í˜¸ì¶œ ì¶”ê°€
                        setPagination(pagination); // í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸ ì¶”ê°€
                    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
                        setIsSidebarOpen(true); // ì‚¬ì´ë“œë°” ì—´ê¸° ì¶”ê°€
                        setSearch(data);
                    } else if (status === kakao.maps.services.Status.ERROR) {
                        console.error('ê²€ìƒ‰ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.');
                    }
                },
                options
            );
        }

        // í´ë¦­í•œ ë§ˆì»¤ë¡œ ì¤‘ì‹¬ ì¢Œí‘œ ì´ë™ & CustomOverlay í‘œì‹œí•˜ê¸°
        function moveLatLng(data) {
            var newLatLng = new kakao.maps.LatLng(data.y, data.x);
            map.panTo(newLatLng);
        }

        // ë§ˆì»¤ë¥¼ ìƒì„±í•˜ê³  ì§€ë„ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function displayMarker(place) {
            // ë§ˆì»¤ë¥¼ ìƒì„±í•˜ê³  ì§€ë„ì— í‘œì‹œí•©ë‹ˆë‹¤
            addMarker(place);

            // ë§ˆì»¤ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
            kakao.maps.event.addEventListener(marker, 'click', function() {
                // ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ì¥ì†Œëª…ì´ ì¸í¬ìœˆë„ìš°ì— í‘œì¶œë©ë‹ˆë‹¤
                infowindow.setContent('<div style="padding:5px;font-size:12px;">' + place.place_name + '</div>');
                infowindow.open(map, marker);
            });
        }

        function addMarker(place){
            var marker = new kakao.maps.Marker({
                map: map,
                position: new kakao.maps.LatLng(place.y, place.x)
            });
            markers.push(marker)
        }





        function addMarker(place) {
            var marker = new kakao.maps.Marker({
                map: map,
                position: new kakao.maps.LatLng(place.y, place.x)
            });
            markers.push(marker);
        }

        function deleteMarkers() {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }
            markers = [];
        }

    });




</script>
</body>

</html>

